---
apiVersion: v1
kind: Pod
metadata:
  name: masterservice-operator-test
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
  - name: masterservice-operator-test
    image: appropriate/curl:latest
    command:
    - sh
    - -c
    - |
      a=$(for i in 1 2 3 4 5; do curl -s http://hostname-server-all/; done | sort | uniq | wc -l); \
      b=$(for i in 1 2 3 4 5; do curl -s http://hostname-server/; done | sort | uniq | wc -l); \
      echo "master-all service returned ${a} pods"; \
      echo "master service returned ${b} pods"; \
      [ $a -lt 2 ] && exit 1; \
      [ $b -gt 1 ] && exit 1; \
      [ $b -eq 0 ] && exit 1; \
      exit 0;
  restartPolicy: Never
